# R-Auto: 楽天ROOM自動化ツール

`R-Auto` は、楽天ROOMにおける一連の活動（商品調達、記事投稿、エンゲージメントアクション）を自動化するためのツールです。Web UIを通じて、各種タスクのスケジュール管理や手動実行が可能です。

 <!-- TODO: スクリーンショットをアップロードしてURLを差し替えてください -->

## ✨ 主な機能

- **スケジュール管理**:
  - 各タスク（商品調達, 記事投稿, エンゲージメント）の実行時刻をWeb UIから柔軟に設定・変更できます。
  - 1つのタスクに複数の実行時刻を設定可能です。
  - 設定したスケジュールはファイルに保存され、アプリケーションを再起動しても維持されます。
- **ランダム実行**:
  - 設定時刻きっかりではなく、指定された範囲内（例: 0〜30分）でランダムに遅延してタスクを実行し、より人間らしい動作をシミュレートします。
  - ランダム遅延の最大時間はWeb UIから設定可能です。
- **手動実行とデバッグ**:
  - **即時実行**: スケジュールに関わらず、任意のタスクをボタン一つで実行できます。
  - **認証状態の保存**: VNC経由でブラウザを直接操作し、安全に手動ログインを行い、その認証情報（Cookieなど）をファイルに保存します。
- **Playwrightによるブラウザ自動化**:
  - データベースに登録された「未投稿」の商品を、Playwrightを使って楽天ROOMに自動でコレ！（投稿）します。
  - 投稿後は、データベースのステータスを自動で更新します。

## 🛠️ 技術スタック

- **バックエンド**: Python, FastAPI, Schedule
- **フロントエンド**: HTML, CSS, JavaScript, Bootstrap
- **ブラウザ自動化**: Playwright
- **コンテナ化**: Docker, Docker Compose
- **データベース**: SQLite

## 🚀 導入と実行方法

### 1. 前提条件

- Docker と Docker Compose がインストールされていること。

### 2. 設定

プロジェクトのルートにある `.env` ファイルを環境に合わせて設定します。（現在は空ですが、将来的にAPIキーなどを追加する可能性があります）

### 3. データベースの準備

`app/database.py` 内のサンプルデータを、実際の楽天ROOMの商品コレ！ページのURLに書き換えてください。

```python
# app/database.py の一部
def init_db():
    # ...
        if cursor.fetchone()[0] == 0:
            logging.info("サンプルデータを挿入します。")
            # ↓↓↓ このURLを実際の楽天ROOMの商品コレ！ページのURLに書き換えてください
            cursor.execute("INSERT INTO products (name, url, status) VALUES (?, ?, ?)",
                           ('【要変更】すごいガジェット', 'https://room.rakuten.co.jp/コレ！する商品のURL', '未'))
```

### 4. アプリケーションの起動

プロジェクトのルートディレクトリで、以下のコマンドを実行します。

```bash
docker-compose up --build
```

これにより、`app`（メインアプリ）と `browser`（VNC用ブラウザ）の2つのコンテナが起動します。

### 5. 初回ログイン

ブラウザ自動操作機能を使うには、最初に一度だけ対象サイトに手動でログインし、認証情報をファイルに保存する必要があります。

1. Webブラウザで `http://localhost:8000` を開き、コントロールパネルにアクセスします。
2. 「**認証状態の保存**」タスクの「<i class="bi bi-play-fill"></i> 即時実行」ボタンをクリックします。
3. **VNCクライアント**（RealVNC Viewerなど）を使い、アドレス `localhost:5900` に接続します。
4. コンテナ内のブラウザ画面が表示されるので、その中で対象サイト（楽天ROOMなど）に**手動でログイン**を完了させてください。
5. ログイン後、タスクが自動終了するまで待つと、認証情報が `db/state.json` に保存されます。
6. ログイン状態が正しく保存されたかを確認するには、Web UIに戻り、「**ログイン状態チェック**」タスクを即時実行します。ターミナルのログに「成功: ログイン状態が維持されています。」と表示されれば成功です。

### 6. 通常利用

- **コントロールパネル**: `http://localhost:8000`
  - 各タスクのスケジュール設定や即時実行ができます。
- **VNCビューア**: `localhost:5900`
  - 「認証状態の保存」タスク実行中に、ブラウザの動作をリアルタイムで確認できます。

## 📝 今後の展望

- ログ確認画面の実装
- AIチャットによる対話型操作
- 商品管理UIの追加

---

*This project is for educational and experimental purposes.*